//  Copyright (c) hepangda
//
//  This source code is licensed under the MIT license found in the
//  LICENSE file in the root directory of this source tree.

#include "core/karma.h"
#include "utils/concurrency_proxy.h"
#include "protocol/dnsds.h"
#include "protocol/dns_domain_name.h"
#include "utils/test_assist.h"
#include "protocol/dns_packet.h"
#include <iostream>

//constexpr bool kTestFlag = true;
constexpr bool kTestFlag = false;

int main(int argc, const char *argv[]) {
  using namespace chara;

  TestAssist{kTestFlag, [] {
    Byte c[] = {
        0xe8, 0x1c, 0x81, 0x80, 0x00, 0x01, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x03, 0x77, 0x77, 0x77, 0x09, 0x6a,
        0x65, 0x74, 0x62, 0x72, 0x61, 0x69, 0x6e, 0x73, 0x03, 0x63, 0x6f, 0x6d, 0x00, 0x00, 0x01, 0x00, 0x01, 0xc0,
        0x0c, 0x00, 0x05, 0x00, 0x01, 0x00, 0x00, 0x00, 0x22, 0x00, 0x0f, 0x0c, 0x77, 0x77, 0x77, 0x2d, 0x77, 0x65,
        0x69, 0x67, 0x68, 0x74, 0x65, 0x64, 0xc0, 0x10, 0xc0, 0x2f, 0x00, 0x05, 0x00, 0x01, 0x00, 0x00, 0x00, 0x22,
        0x00, 0x1f, 0x0c, 0x77, 0x33, 0x6a, 0x62, 0x63, 0x6f, 0x6d, 0x2d, 0x70, 0x72, 0x6f, 0x64, 0x03, 0x61, 0x77,
        0x73, 0x08, 0x69, 0x6e, 0x74, 0x65, 0x6c, 0x6c, 0x69, 0x6a, 0x03, 0x6e, 0x65, 0x74, 0x00, 0xc0, 0x4a, 0x00,
        0x05, 0x00, 0x01, 0x00, 0x00, 0x00, 0x22, 0x00, 0x18, 0x05, 0x65, 0x6e, 0x74, 0x72, 0x79, 0x07, 0x70, 0x72,
        0x6f, 0x64, 0x2d, 0x75, 0x73, 0x07, 0x77, 0x33, 0x6a, 0x62, 0x63, 0x6f, 0x6d, 0xc0, 0x57, 0xc0, 0x75, 0x00,
        0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x22, 0x00, 0x04, 0x34, 0x0a, 0xa2, 0xd7, 0xc0, 0x75, 0x00, 0x01, 0x00,
        0x01, 0x00, 0x00, 0x00, 0x22, 0x00, 0x04, 0x36, 0xbb, 0xf1, 0x87
    };

    auto pkt = ConstructDnsPacket(c);
//    std::cout << pkt.header_.questions() << std::endl;
//    std::cout << pkt.questions_[0].domain_name_string() << std::endl;
  }};

  return ConcurrencyProxy{[] {
    Karma().Run();
  }}.Wait();
}